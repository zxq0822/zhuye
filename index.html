<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qing搜索</title>
    <link rel="icon" href="wangzhantubiao.ico" type="image/x-icon">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                        neutral: '#F8FAFC',
                        dark: '#1E293B',
                        sun: '#FFD700',
                        moon: '#9CA3AF'
                    },
                    fontFamily: {
                        inter: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }

            .search-shadow {
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            }

            .engine-active {
                @apply bg-primary text-white border-primary;
            }

            .dropdown-content {
                transform: scaleY(0);
                transform-origin: top;
                transition: transform 0.2s ease;
            }

            .dropdown-active .dropdown-content {
                transform: scaleY(1);
            }

            .engine-icon {
                width: 18px;
                height: 18px;
                display: inline-block;
                background-size: contain;
                background-repeat: no-repeat;
                margin-right: 6px;
            }

            .icon-baidu {
                background-image: url('faviconbaidu.ico');
            }

            .icon-bing {
                background-image: url('faviconbing.ico');
            }

            .icon-google {
                background-image: url('favicongoogle.ico');
            }

            .icon-mitata {
                background-image: url('faviconmeta.ico');
            }

            /* 黑暗模式样式 */
            .dark-mode {
                background-color: #1E293B;
                color: white;
            }

            .dark-mode .bg-white {
                background-color: #334155;
                color: white;
            }

            .dark-mode .bg-white\/80 {
                background-color: #334155;
                color: white;
            }

            .dark-mode .bg-white\/95 {
                background-color: #334155;
                color: white;
            }

            .dark-mode .text-gray-800 {
                color: white;
            }

            .dark-mode .text-gray-400 {
                color: #94a3b8;
            }

            .dark-mode .border-gray-200 {
                border-color: #475569;
            }

            .dark-mode .border-gray-100 {
                border-color: #475569;
            }

            .dark-mode .hover:bg-gray-50 {
                --tw-bg-opacity: 1;
                background-color: rgb(51 65 85 / var(--tw-bg-opacity));
            }

            /* 优化后的黑暗模式开关样式 */
            .theme-toggle {
                position: relative;
                display: inline-block;
                width: 64px;
                height: 32px;
            }

            .theme-toggle input {
                opacity: 0;
                width: 0;
                height: 0;
            }

            .theme-toggle-slider {
                position: absolute;
                cursor: pointer;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: #e2e8f0;
                transition: .4s;
                border-radius: 34px;
                box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .theme-toggle input:checked + .theme-toggle-slider {
                background-color: #1e293b;
            }

            .theme-toggle-slider:before {
                position: absolute;
                content: "";
                height: 24px;
                width: 24px;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
                border-radius: 50%;
                box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            }

            .theme-toggle input:checked + .theme-toggle-slider:before {
                transform: translateX(32px);
            }

            .theme-icon {
                position: absolute;
                top: 50%;
                transform: translateY(-50%);
                font-size: 16px;
                transition: all 0.3s ease;
                z-index: 10;
            }

            .theme-icon-sun {
                left: 8px;
                color: #94a3b8;
            }

            .theme-icon-moon {
                right: 8px;
                color: #94a3b8;
            }

            .theme-toggle input:not(:checked) ~ .theme-icon-sun {
                color: #FFD700;
                transform: translateY(-50%) scale(1.2);
            }

            .theme-toggle input:checked ~ .theme-icon-moon {
                color: #ffffff;
                transform: translateY(-50%) scale(1.2);
            }

            /* 为太阳添加光芒效果 */
            .theme-icon-sun::after {
                content: "";
                position: absolute;
                top: 50%;
                left: 50%;
                width: 24px;
                height: 24px;
                background: rgba(255, 215, 0, 0.3);
                border-radius: 50%;
                transform: translate(-50%, -50%);
                opacity: 0;
                transition: opacity 0.3s ease;
            }

            .theme-toggle input:not(:checked) ~ .theme-icon-sun::after {
                opacity: 1;
            }

            /* 背景图样式 - 动态设置 */
            .bg-image {
                background-size: cover;
                background-position: center;
                background-attachment: fixed;
                transition: background-image 0.5s ease;
            }

            .bg-image-overlay {
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(30, 41, 59, 0.2);
                transition: background-color 0.5s ease;
            }

            /* 完全透明的搜索框 - 移除磨砂玻璃效果 */
            .transparent-search {
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .dark-mode .transparent-search {
                background-color: rgba(30, 41, 59, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            /* 搜索建议列表样式 - 移除磨砂玻璃效果 */
            .transparent-suggestions {
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .dark-mode .transparent-suggestions {
                background-color: rgba(30, 41, 59, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            /* 鼠标悬停效果增强 */
            .suggestion-item {
                transition: all 0.2s ease;
            }

            .suggestion-item:hover {
                background-color: rgba(255, 255, 255, 0.15);
            }

            .dark-mode .suggestion-item:hover {
                background-color: rgba(255, 255, 255, 0.05);
            }

            /* 标题样式 */
            .search-title {
                font-size: clamp(2rem, 5vw, 3.5rem);
                font-weight: 800;
                letter-spacing: -0.05em;
                margin-bottom: 1.5rem;
                text-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                transition: all 0.3s ease;
            }

            .search-title:hover {
                transform: translateY(-2px);
            }

            /* 移动端适配 */
            @media (max-width: 640px) {
                .search-title {
                    font-size: 2.5rem;
                    margin-bottom: 1rem;
                }
            }

            /* 类似Edge的圆形书签样式 */
            .bookmark-circle {
                position: relative;
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .bookmark-icon-container {
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                overflow: hidden;
                transition: all 0.2s ease;
                position: relative;
            }

            .dark-mode .bookmark-icon-container {
                background-color: rgba(255, 255, 255, 0.05);
            }

            .bookmark-circle:hover .bookmark-icon-container {
                transform: translateY(-4px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
                border-color: rgba(255, 255, 255, 0.2);
            }

            .bookmark-icon {
                width: 28px;
                height: 28px;
                background-size: contain;
                background-repeat: no-repeat;
                background-position: center;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                text-transform: uppercase;
            }

            /* 首字母显示样式 */
            .bookmark-letter {
                font-size: 16px;
                line-height: 1;
            }

            .bookmark-title {
                margin-top: 8px;
                font-size: 0.8rem;
                font-weight: 500;
                text-align: center;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                width: 100%;
                padding: 0 4px;
            }

            .bookmark-actions {
                position: absolute;
                top: -8px;
                right: -8px;
                opacity: 0;
                transition: opacity 0.2s ease;
            }

            .bookmark-circle:hover .bookmark-actions {
                opacity: 1;
            }

            .bookmark-actions button {
                background-color: rgba(0, 0, 0, 0.5);
                color: white;
                width: 20px;
                height: 20px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 0.7rem;
                transition: background-color 0.2s ease;
                border: none;
            }

            .bookmark-actions button:hover {
                background-color: rgba(0, 0, 0, 0.7);
            }

            /* 添加书签按钮样式 */
            .add-bookmark-circle {
                width: 56px;
                height: 56px;
                border-radius: 50%;
                background-color: rgba(255, 255, 255, 0.05);
                border: 1px dashed rgba(255, 255, 255, 0.2);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                transition: all 0.2s ease;
                cursor: pointer;
            }

            .add-bookmark-circle:hover {
                background-color: rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.3);
            }

            .add-icon {
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            /* 添加书签表单样式 */
            .add-bookmark-modal {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.5);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 50;
                opacity: 0;
                pointer-events: none;
                transition: opacity 0.3s ease;
            }

            .add-bookmark-modal.active {
                opacity: 1;
                pointer-events: auto;
            }

            .modal-content {
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 16px;
                padding: 24px;
                width: 100%;
                max-width: 400px;
                backdrop-filter: blur(10px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            }

            .dark-mode .modal-content {
                background-color: rgba(30, 41, 59, 0.9);
            }

            .modal-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 16px;
            }

            .modal-title {
                font-size: 1.25rem;
                font-weight: 600;
            }

            .close-modal {
                background: none;
                border: none;
                color: white;
                cursor: pointer;
                font-size: 1.5rem;
                opacity: 0.7;
                transition: opacity 0.2s ease;
            }

            .close-modal:hover {
                opacity: 1;
            }

            .modal-form {
                display: flex;
                flex-direction: column;
                gap: 16px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
                gap: 8px;
            }

            .form-label {
                font-size: 0.9rem;
                font-weight: 500;
                color: rgba(255, 255, 255, 0.8);
            }

            .form-input {
                background-color: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                padding: 10px 12px;
                color: white;
                font-size: 1rem;
                transition: all 0.2s ease;
            }

            .form-input:focus {
                outline: none;
                border-color: rgba(22, 93, 255, 0.8);
                box-shadow: 0 0 0 2px rgba(22, 93, 255, 0.2);
            }

            .dark-mode .form-input {
                background-color: rgba(255, 255, 255, 0.05);
            }

            .modal-actions {
                display: flex;
                justify-content: flex-end;
                gap: 12px;
                margin-top: 8px;
            }

            .btn {
                padding: 8px 16px;
                border-radius: 8px;
                font-weight: 500;
                cursor: pointer;
                transition: all 0.2s ease;
            }

            .btn-cancel {
                background-color: rgba(255, 255, 255, 0.1);
                color: white;
            }

            .btn-cancel:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .btn-primary {
                background-color: rgba(22, 93, 255, 0.9);
                color: white;
            }

            .btn-primary:hover {
                background-color: rgba(22, 93, 255, 1);
            }

            /* 加载指示器样式 */
            .loading-indicator {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 40px;
                height: 40px;
                border: 4px solid rgba(255, 255, 255, 0.3);
                border-radius: 50%;
                border-top-color: #165DFF;
                animation: spin 1s linear infinite;
                z-index: 10;
            }

            @keyframes spin {
                to {
                    transform: translate(-50%, -50%) rotate(360deg);
                }
            }
        }
    </style>
</head>

<body class="font-inter min-h-screen flex flex-col items-center justify-start px-4 py-8 dark-mode">
    <!-- 背景图容器 -->
    <div id="bg-image" class="bg-image fixed inset-0 z-0"></div>
    <!-- 背景图遮罩层 -->
    <div class="bg-image-overlay z-10"></div>

    <!-- 进一步优化后的黑暗模式开关 -->
    <div class="fixed top-4 right-4 z-30">
        <label class="theme-toggle">
            <input type="checkbox" id="dark-mode-toggle" class="hidden">
            <span class="theme-toggle-slider"></span>
            <i class="fa fa-sun-o theme-icon theme-icon-sun"></i>
            <i class="fa fa-moon-o theme-icon theme-icon-moon"></i>
        </label>
    </div>

    <!-- 搜索区域 -->
    <div class="w-full max-w-4xl z-20 mt-24 md:mt-32">
        <!-- 搜索标题 -->
        <h1 class="search-title text-center">
            <span class="text-white">Qing</span>
            <span class="text-primary">搜索</span>
        </h1>

        <!-- 搜索框 -->
        <div class="relative group">
            <form id="search-form" class="w-full">
                <div
                    class="flex items-center rounded-full transparent-search p-1 search-shadow transition-all duration-300 group-hover:border-primary/50 group-focus-within:border-primary/70">
                    <!-- 搜索引擎下拉菜单 -->
                    <div id="engine-dropdown" class="dropdown relative mr-2">
                        <button id="current-engine"
                            class="engine-btn flex items-center px-3 py-1.5 text-sm font-medium transition-all duration-200 whitespace-nowrap focus:outline-none rounded-full bg-white/10 hover:bg-white/20 dark:hover:bg-white/5">
                            <span class="engine-icon icon-baidu"></span>
                            <i class="fa fa-chevron-down ml-1 text-xs"></i>
                        </button>
                        <div id="engine-options"
                            class="dropdown-content absolute top-full left-0 mt-1 transparent-suggestions rounded-xl shadow-lg overflow-hidden w-24 z-20">
                            <button data-engine="baidu"
                                class="engine-option w-full text-left px-2 py-2 suggestion-item flex items-center">
                                <span class="engine-icon icon-baidu"></span> 百度
                            </button>
                            <button data-engine="bing"
                                class="engine-option w-full text-left px-2 py-2 suggestion-item flex items-center">
                                <span class="engine-icon icon-bing"></span> 必应
                            </button>
                            <button data-engine="google"
                                class="engine-option w-full text-left px-2 py-2 suggestion-item flex items-center">
                                <span class="engine-icon icon-google"></span> 谷歌
                            </button>
                            <button data-engine="mitata"
                                class="engine-option w-full text-left px-2 py-2 suggestion-item flex items-center">
                                <span class="engine-icon icon-mitata"></span> 秘塔
                            </button>
                        </div>
                    </div>

                    <!-- 分隔线 -->
                    <div class="h-6 w-px bg-white/20 dark:bg-white/10"></div>

                    <div class="flex items-center px-3">
                        <i id="search-icon" class="fa fa-search text-gray-400 text-lg"></i>
                    </div>
                    <input type="text" id="search-input" placeholder="你想搜啥..."
                        class="flex-1 w-full py-2 px-2 text-gray-800 dark:text-white bg-transparent outline-none text-lg"
                        autocomplete="off">
                    <button type="submit"
                        class="bg-primary/90 text-white px-5 py-1.5 rounded-full font-medium transition-all duration-200 hover:bg-primary focus:outline-none focus:ring-2 focus:ring-primary/50 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed">
                        <i class="fa fa-search text-lg"></i>
                    </button>
                </div>
            </form>

            <!-- 搜索建议 -->
            <div id="suggestions"
                class="hidden absolute top-full left-0 right-0 mt-2 transparent-suggestions rounded-xl shadow-lg overflow-hidden z-10">
                <ul id="suggestions-list" class="divide-y divide-white/10 dark:divide-white/5"></ul>
            </div>

            <!-- 书签区域 - 类似Edge的设计 -->
            <div id="bookmark-area" class="mt-8">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-lg font-medium text-white">快速访问</h2>
                    <button id="add-bookmark-btn" class="text-primary hover:underline text-sm">添加网站</button>
                </div>
                <div id="bookmark-grid" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-4">
                </div>
            </div>
        </div>
    </div>

    <!-- 添加书签模态框 -->
    <div id="add-bookmark-modal" class="add-bookmark-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">添加书签</h3>
                <button id="close-modal" class="close-modal">&times;</button>
            </div>
            <form id="bookmark-form" class="modal-form">
                <div class="form-group">
                    <label for="bookmark-name" class="form-label">网站名称</label>
                    <input type="text" id="bookmark-name" class="form-input" placeholder="例如：Baidu" required>
                </div>
                <div class="form-group">
                    <label for="bookmark-url" class="form-label">网站URL</label>
                    <input type="url" id="bookmark-url" class="form-input" placeholder="例如：https://www.baidu.com" required>
                </div>
                <div class="form-group">
                    <label for="bookmark-icon" class="form-label">网站图标URL（可选）</label>
                    <input type="url" id="bookmark-icon" class="form-input" placeholder="例如：https://www.baidu.com/favicon.ico">
                </div>
                <div class="modal-actions">
                    <button type="button" id="cancel-add-bookmark" class="btn btn-cancel">取消</button>
                    <button type="submit" class="btn btn-primary">添加</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // 防抖函数定义
        function debounce(func, wait) {
            let timeout;
            return function(...args) {
                const context = this;
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(context, args), wait);
            };
        }

        // 搜索引擎配置
        const searchEngines = {
            'baidu': {
                url: 'https://www.baidu.com/s',
                param: 'wd',
                iconClass: 'icon-baidu',
                color: '#2319DC',
                name: '百度'
            },
            'bing': {
                url: 'https://cn.bing.com/search',
                param: 'q',
                iconClass: 'icon-bing',
                color: '#008373',
                name: '必应'
            },
            'google': {
                url: 'https://www.google.com/search',
                param: 'q',
                iconClass: 'icon-google',
                color: '#4285F4',
                name: '谷歌'
            },
            'mitata': {
                url: 'https://www.metaso.cn/search',
                param: 'q',
                iconClass: 'icon-mitata',
                color: '#165DFF',
                name: '秘塔'
            }
        };

        // 当前选中的搜索引擎
        let currentEngine = 'baidu';

        // DOM元素
        const searchForm = document.getElementById('search-form');
        const searchInput = document.getElementById('search-input');
        const searchIcon = document.getElementById('search-icon');
        const suggestions = document.getElementById('suggestions');
        const suggestionsList = document.getElementById('suggestions-list');
        const engineDropdown = document.getElementById('engine-dropdown');
        const currentEngineBtn = document.getElementById('current-engine');
        const engineOptions = document.getElementById('engine-options');
        const engineOptionBtns = document.querySelectorAll('.engine-option');
        const darkModeToggle = document.getElementById('dark-mode-toggle');
        const body = document.body;
        const bookmarkGrid = document.getElementById('bookmark-grid');
        const addBookmarkBtn = document.getElementById('add-bookmark-btn');
        const bgImage = document.getElementById('bg-image');
        
        // 模态框相关元素
        const addBookmarkModal = document.getElementById('add-bookmark-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const cancelAddBookmarkBtn = document.getElementById('cancel-add-bookmark');
        const bookmarkForm = document.getElementById('bookmark-form');
        const bookmarkNameInput = document.getElementById('bookmark-name');
        const bookmarkUrlInput = document.getElementById('bookmark-url');
        const bookmarkIconInput = document.getElementById('bookmark-icon');

        // 从本地存储中获取书签
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [
            {
                id: '1',
                name: 'GitHub',
                url: 'https://github.com',
                icon: 'https://github.com/favicon.ico'
            },
            {
                id: '2',
                name: 'Cloudflare',
                url: 'https://dash.cloudflare.com/44fdec9c6ed5984993cbf9ee58b9ebd3',
                icon: 'https://cloudflare.com/favicon.ico'
            },
            {
                id: '3',
                name: 'YouTube',
                url: 'https://www.youtube.com',
                icon: 'https://youtube.com/favicon.ico'
            },
            {
                id: '4',
                name: 'Bilibili',
                url: 'https://www.bilibili.com',
                icon: 'https://bilibili.com/favicon.ico'
            }
        ];

        // 初始化搜索引擎下拉菜单
        engineOptionBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                const engine = btn.getAttribute('data-engine');
                setCurrentEngine(engine);
                engineDropdown.classList.remove('dropdown-active');
            });
        });

        // 点击下拉菜单按钮切换显示状态
        currentEngineBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            engineDropdown.classList.toggle('dropdown-active');
        });

        // 点击其他区域关闭下拉菜单
        document.addEventListener('click', () => {
            engineDropdown.classList.remove('dropdown-active');
        });

        // 设置当前搜索引擎
        function setCurrentEngine(engine) {
            currentEngine = engine;
            const engineData = searchEngines[engine];
            currentEngineBtn.innerHTML = `
                <span class="engine-icon ${engineData.iconClass}"></span>
                <i class="fa fa-chevron-down ml-1 text-xs"></i>
            `;
            updateSearchIcon();
        }

        // 更新搜索图标
        function updateSearchIcon() {
            const engine = searchEngines[currentEngine];
            searchIcon.className = `fa ${engine.icon || 'fa-search'} text-gray-400 text-lg`;
        }

        // 处理搜索表单提交
        searchForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const query = searchInput.value.trim();
            if (query) {
                let searchUrl = searchEngines[currentEngine].url;
                if (currentEngine === 'bing') {
                    searchUrl += '?setmkt=zh-CN&setlang=zh-CN';
                    searchUrl += `&q=${encodeURIComponent(query)}`;
                } else if (currentEngine === 'mitata') {
                    searchUrl = `https://metaso.cn/?q=${encodeURIComponent(query)}`;
                } else {
                    searchUrl += `?${searchEngines[currentEngine].param}=${encodeURIComponent(query)}`;
                }
                window.location.href = searchUrl;
            }
        });

        // 搜索建议功能
        searchInput.addEventListener('input', debounce(async function () {
            const query = this.value.trim();
            if (!query) {
                suggestions.classList.add('hidden');
                return;
            }

            try {
                let suggestionsData = [];
                if (currentEngine === 'baidu') {
                    const response = await fetch(`https://suggestion.baidu.com/su?wd=${encodeURIComponent(query)}&cb=JSON_CALLBACK`, {
                        mode: 'cors',
                        headers: {
                            'Referer': 'https://www.baidu.com'
                        }
                    });
                    const text = await response.text();
                    const jsonpRegex = /JSON_CALLBACK\((.*)\)/;
                    const matches = text.match(jsonpRegex);
                    if (matches && matches[1]) {
                        suggestionsData = JSON.parse(matches[1]).s || [];
                    }
                } else if (currentEngine === 'bing') {
                    const response = await fetch(`https://api.bing.com/osjson.aspx?query=${encodeURIComponent(query)}`);
                    const data = await response.json();
                    suggestionsData = data[1] || [];
                } else if (currentEngine === 'google') {
                    const response = await fetch(`https://www.google.com/complete/search?client=chrome&q=${encodeURIComponent(query)}`);
                    const text = await response.text();
                    try {
                        suggestionsData = JSON.parse(text)[1] || [];
                    } catch (e) {}
                } else if (currentEngine === 'mitata') {
                    try {
                        const response = await fetch(`https://suggestion.baidu.com/su?wd=${encodeURIComponent(query)}&cb=JSON_CALLBACK`, {
                            mode: 'cors',
                            headers: {
                                'Referer': 'https://www.baidu.com'
                            }
                        });
                        const text = await response.text();
                        const jsonpRegex = /JSON_CALLBACK\((.*)\)/;
                        const matches = text.match(jsonpRegex);
                        if (matches && matches[1]) {
                            suggestionsData = JSON.parse(matches[1]).s || [];
                        }
                    } catch (error) {}
                }
                displaySuggestions(suggestionsData);
            } catch (error) {
                console.error('Error fetching suggestions:', error);
                suggestions.classList.add('hidden');
            }
        }, 300));

        // 点击其他区域关闭建议
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
                suggestions.classList.add('hidden');
            }
        });

        // 显示搜索建议
        function displaySuggestions(suggestionsData) {
            if (suggestionsData.length === 0) {
                suggestions.classList.add('hidden');
                return;
            }

            suggestionsList.innerHTML = '';
            suggestionsData.forEach(suggestion => {
                const li = document.createElement('li');
                li.className = 'suggestion-item px-4 py-2 hover:bg-white/10 cursor-pointer';
                li.textContent = suggestion;
                li.addEventListener('click', () => {
                    searchInput.value = suggestion;
                    searchForm.dispatchEvent(new Event('submit'));
                });
                suggestionsList.appendChild(li);
            });
            suggestions.classList.remove('hidden');
        }

        // 键盘导航建议列表
        let currentSuggestionIndex = -1;
        searchInput.addEventListener('keydown', (e) => {
            const suggestionItems = suggestionsList.querySelectorAll('li');
            if (suggestionItems.length === 0) return;

            if (e.key === 'ArrowDown') {
                e.preventDefault();
                currentSuggestionIndex = (currentSuggestionIndex + 1) % suggestionItems.length;
                highlightSuggestion();
            } else if (e.key === 'ArrowUp') {
                e.preventDefault();
                currentSuggestionIndex = (currentSuggestionIndex - 1 + suggestionItems.length) % suggestionItems.length;
                highlightSuggestion();
            } else if (e.key === 'Enter' && currentSuggestionIndex !== -1) {
                e.preventDefault();
                searchInput.value = suggestionItems[currentSuggestionIndex].textContent;
                searchForm.dispatchEvent(new Event('submit'));
            }
        });

        // 高亮选中的建议
        function highlightSuggestion() {
            const suggestionItems = suggestionsList.querySelectorAll('li');
            suggestionItems.forEach((item, index) => {
                item.classList.toggle('bg-white/10', index === currentSuggestionIndex);
            });
        }

        // 黑暗模式切换
        darkModeToggle.addEventListener('change', () => {
            body.classList.toggle('dark-mode');
            updateBackgroundImage();
        });

        // 更新背景图片
        function updateBackgroundImage() {
            if (body.classList.contains('dark-mode')) {
                bgImage.style.backgroundImage = 'url("beijingtu.png")';
            } else {
                bgImage.style.backgroundImage = 'url("beijingtu1.png")';
            }
        }

        // 渲染书签
        function renderBookmarks() {
            bookmarkGrid.innerHTML = '';
            bookmarks.forEach(bookmark => {
                const bookmarkEl = document.createElement('div');
                bookmarkEl.className = 'bookmark-circle';
                bookmarkEl.setAttribute('data-id', bookmark.id);
                
                let iconContent = '';
                if (bookmark.icon) {
                    iconContent = `<div class="bookmark-icon" style="background-image: url('${bookmark.icon}')"></div>`;
                } else {
                    const firstChar = bookmark.name.charAt(0).toUpperCase();
                    iconContent = `<div class="bookmark-icon"><span class="bookmark-letter">${firstChar}</span></div>`;
                }
                
                bookmarkEl.innerHTML = `
                    <div class="bookmark-icon-container">
                        ${iconContent}
                    </div>
                    <div class="bookmark-title">${bookmark.name}</div>
                    <div class="bookmark-actions">
                        <button class="delete-bookmark" title="删除">
                            <i class="fa fa-times"></i>
                        </button>
                    </div>
                `;
                
                bookmarkEl.addEventListener('click', (e) => {
                    if (e.target.closest('.delete-bookmark')) return;
                    window.open(bookmark.url, '_blank');
                });
                
                bookmarkEl.querySelector('.delete-bookmark').addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteBookmark(bookmark.id);
                });
                
                bookmarkGrid.appendChild(bookmarkEl);
            });
            
            const addBookmarkEl = document.createElement('div');
            addBookmarkEl.className = 'bookmark-circle';
            addBookmarkEl.innerHTML = `
                <div class="add-bookmark-circle">
                    <div class="add-icon">
                        <i class="fa fa-plus text-gray-400"></i>
                    </div>
                </div>
                <div class="bookmark-title text-gray-400">添加</div>
            `;
            
            addBookmarkEl.addEventListener('click', openAddBookmarkModal);
            bookmarkGrid.appendChild(addBookmarkEl);
        }

        // 删除书签
        function deleteBookmark(id) {
            bookmarks = bookmarks.filter(bookmark => bookmark.id !== id);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            renderBookmarks();
        }

        // 打开添加书签模态框
        function openAddBookmarkModal() {
            addBookmarkModal.classList.add('active');
            bookmarkNameInput.focus();
        }

        // 关闭添加书签模态框
        function closeAddBookmarkModal() {
            addBookmarkModal.classList.remove('active');
            bookmarkForm.reset();
        }

        // 事件绑定
        addBookmarkBtn.addEventListener('click', openAddBookmarkModal);
        closeModalBtn.addEventListener('click', closeAddBookmarkModal);
        cancelAddBookmarkBtn.addEventListener('click', closeAddBookmarkModal);
        addBookmarkModal.addEventListener('click', (e) => {
            if (e.target === addBookmarkModal) closeAddBookmarkModal();
        });

        // 表单提交
        bookmarkForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const name = bookmarkNameInput.value.trim();
            const url = bookmarkUrlInput.value.trim();
            const icon = bookmarkIconInput.value.trim() || null;
            
            if (!name || !url) return;
            
            const newBookmark = {
                id: Date.now().toString(),
                name,
                url,
                icon
            };
            
            bookmarks.push(newBookmark);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            closeAddBookmarkModal();
            renderBookmarks();
        });

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化黑暗模式状态
            darkModeToggle.checked = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (darkModeToggle.checked) {
                body.classList.add('dark-mode');
            }
            updateBackgroundImage();
            
            setCurrentEngine(currentEngine);
            renderBookmarks();
        });
    </script>
</body>

</html>
